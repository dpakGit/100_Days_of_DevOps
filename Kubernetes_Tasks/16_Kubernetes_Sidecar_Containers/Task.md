### Task : Kubernetes Sidecar Containers

We have a web server container running the nginx image. The access and error logs generated by the web server are not critical enough to be placed on a persistent volume. However, Nautilus developers need access to the last 24 hours of logs so that they can trace issues and bugs. Therefore, we need to ship the access and error logs for the web server to a log-aggregation service. Following the separation of concerns principle, we implement the Sidecar pattern by deploying a second container that ships the error and access logs from nginx. Nginx does one thing, and it does it well—serving web pages. The second container also specializes in its task—shipping logs. Since containers are running on the same Pod, we can use a shared emptyDir volume to read and write logs.

Create a pod named webserver.

Create an emptyDir volume shared-logs.

Create two containers from nginx and ubuntu images with latest tag only and remember to mention tag i.e nginx:latest, nginx container name should be nginx-container and ubuntu container name should be sidecar-container on webserver pod.

Add command on sidecar-container "sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"

Mount the volume shared-logs on both containers at location /var/log/nginx, all containers should be up and running.


### What I Did

```
thor@jumphost ~$ vi pod.yaml
thor@jumphost ~$ kubectl apply -f pod.yaml
pod/webserver created
thor@jumphost ~$ kubectl logs webserver sidecar-container
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
thor@jumphost ~$ kubectl logs webserver sidecar-container
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
thor@jumphost ~$ kubectl get po
NAME        READY   STATUS    RESTARTS   AGE
webserver   2/2     Running   0          93s
thor@jumphost ~$ kubectl logs webserver sidecar-container
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
thor@jumphost ~$ kubectl exec -it webserver -c sidecar-container -- sh
# echo 'Sidecar container started'; while true; do echo 'Checking logs...'; cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done
Sidecar container started
Checking logs...
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
Checking logs...
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
Checking logs...
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
Checking logs...
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
exit
exit
Checking logs...
2025/10/21 07:50:46 [notice] 1#1: using the "epoll" event method
2025/10/21 07:50:46 [notice] 1#1: nginx/1.29.2
2025/10/21 07:50:46 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:50:46 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:50:46 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:50:46 [notice] 1#1: start worker processes
2025/10/21 07:50:46 [notice] 1#1: start worker process 79
2025/10/21 07:50:46 [notice] 1#1: start worker process 80
2025/10/21 07:50:46 [notice] 1#1: start worker process 81
2025/10/21 07:50:46 [notice] 1#1: start worker process 82
2025/10/21 07:50:46 [notice] 1#1: start worker process 83
2025/10/21 07:50:46 [notice] 1#1: start worker process 84
2025/10/21 07:50:46 [notice] 1#1: start worker process 85
2025/10/21 07:50:46 [notice] 1#1: start worker process 86
2025/10/21 07:50:46 [notice] 1#1: start worker process 87
2025/10/21 07:50:46 [notice] 1#1: start worker process 88
2025/10/21 07:50:46 [notice] 1#1: start worker process 89
2025/10/21 07:50:46 [notice] 1#1: start worker process 90
2025/10/21 07:50:46 [notice] 1#1: start worker process 91
2025/10/21 07:50:46 [notice] 1#1: start worker process 92
2025/10/21 07:50:46 [notice] 1#1: start worker process 93
2025/10/21 07:50:46 [notice] 1#1: start worker process 94
^C
# 
# exit
command terminated with exit code 130
thor@jumphost ~$ ls
pod.yaml
thor@jumphost ~$ vi pod.yaml 
thor@jumphost ~$ kubectl delete pod webserver
pod "webserver" deleted
^Cthor@jumphost ~$ kubectl delete pod webserver
pod "webserver" deleted
thor@jumphost ~$ ^C
thor@jumphost ~$ kubectl apply -f pod.yaml
pod/webserver created
thor@jumphost ~$ kubectl logs webserver sidecar-container -f
Checking logs...
2025/10/21 07:57:03 [notice] 1#1: using the "epoll" event method
2025/10/21 07:57:03 [notice] 1#1: nginx/1.29.2
2025/10/21 07:57:03 [notice] 1#1: built by gcc 14.2.0 (Debian 14.2.0-19) 
2025/10/21 07:57:03 [notice] 1#1: OS: Linux 5.4.0-1106-gcp
2025/10/21 07:57:03 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2025/10/21 07:57:03 [notice] 1#1: start worker processes
2025/10/21 07:57:03 [notice] 1#1: start worker process 77
2025/10/21 07:57:03 [notice] 1#1: start worker process 78
2025/10/21 07:57:03 [notice] 1#1: start worker process 79
2025/10/21 07:57:03 [notice] 1#1: start worker process 80
2025/10/21 07:57:03 [notice] 1#1: start worker process 81
2025/10/21 07:57:03 [notice] 1#1: start worker process 82
2025/10/21 07:57:03 [notice] 1#1: start worker process 83
2025/10/21 07:57:03 [notice] 1#1: start worker process 84
2025/10/21 07:57:03 [notice] 1#1: start worker process 85
2025/10/21 07:57:03 [notice] 1#1: start worker process 86
2025/10/21 07:57:03 [notice] 1#1: start worker process 87
2025/10/21 07:57:03 [notice] 1#1: start worker process 88
2025/10/21 07:57:03 [notice] 1#1: start worker process 89
2025/10/21 07:57:03 [notice] 1#1: start worker process 90
2025/10/21 07:57:03 [notice] 1#1: start worker process 91
2025/10/21 07:57:03 [notice] 1#1: start worker process 92
^C
thor@jumphost ~$ 
```

### Pod.yaml

```
apiVersion: v1
kind: Pod
metadata:
  name: webserver
spec:
  containers:
  - name: nginx-container
    image: nginx:latest
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx
  - name: sidecar-container
    image: ubuntu:latest
    command: ["stdbuf", "-oL", "sh", "-c", "while true; do echo 'Checking logs...'; cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"]
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx
  volumes:
  - name: shared-logs
    emptyDir: {}

```

